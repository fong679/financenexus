<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Finance Calculator</title>
<link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><rect width='32' height='32' rx='8' fill='%234F46E5'/><text x='50%' y='56%' dominant-baseline='middle' text-anchor='middle' font-size='18'>ğŸ’°</text></svg>" />
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<style>
  :root {
    --primary: #4F46E5;
    --primary-light: #818CF8;
    --primary-dim: rgba(79,70,229,0.15);
    --emerald: #10B981;
    --emerald-light: #6EE7B7;
    --slate: #0F172A;
    --slate-light: #1E293B;
    --border: #334155;
    --muted: #94A3B8;
    --text: #F8FAFC;
    --surface: #1E293B;
    --surface-high: #263346;
    --accent: #F59E0B;
    --topbar-bg: rgba(15,23,42,0.92);
    --input-bg: #0F172A;
    --input-color: white;
    --news-bg: #1a2438;
  }
  :root.light {
    --primary: #4338CA;
    --primary-light: #6366F1;
    --primary-dim: rgba(99,102,241,0.12);
    --emerald: #059669;
    --emerald-light: #047857;
    --slate: #F1F5F9;
    --slate-light: #E2E8F0;
    --border: #CBD5E1;
    --muted: #64748B;
    --text: #0F172A;
    --surface: #FFFFFF;
    --surface-high: #F1F5F9;
    --accent: #D97706;
    --topbar-bg: rgba(255,255,255,0.95);
    --input-bg: #F8FAFC;
    --input-color: #0F172A;
    --news-bg: #F8FAFC;
  }
  html { transition: background 0.3s; }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  html { scroll-behavior: smooth; }
  body {
    background: var(--slate);
    color: var(--text);
    font-family: 'DM Sans', sans-serif;
    font-size: 16px;
    line-height: 1.5;
    min-height: 100vh;
  }
  /* Scrollbar */
  ::-webkit-scrollbar { width: 8px; height: 8px; }
  ::-webkit-scrollbar-track { background: var(--slate); }
  ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 4px; }

  /* Top Bar */
  .topbar {
    position: sticky; top: 0; z-index: 100;
    display: flex; align-items: center; justify-content: space-between;
    padding: 0 24px; height: 70px; /* Taller header */
    background: var(--topbar-bg);
    backdrop-filter: blur(12px);
    border-bottom: 1px solid var(--border);
  }
  .topbar-brand { display: flex; align-items: center; gap: 14px; }
  .brand-icon {
    width: 40px; height: 40px; border-radius: 10px;
    background: linear-gradient(135deg, var(--primary), var(--primary-light));
    display: flex; align-items: center; justify-content: center;
    font-size: 20px;
  }
  .brand-name { font-size: 18px; font-weight: 700; letter-spacing: -0.01em; }
  .brand-sub { font-size: 12px; color: var(--muted); letter-spacing: 0.05em; text-transform: uppercase; }
  .live-badge {
    padding: 6px 14px; border-radius: 99px; font-size: 12px; font-weight: 600;
    background: rgba(16,185,129,0.15); color: var(--emerald-light);
    border: 1px solid rgba(16,185,129,0.3); letter-spacing: 0.05em;
  }

  /* Layout */
  .app-body { display: flex; min-height: calc(100vh - 70px); }

  /* Sidebar */
  .sidebar {
    width: 260px; flex-shrink: 0;
    padding: 24px 16px;
    border-right: 1px solid var(--border);
    background: rgba(30,41,59,0.3);
    display: flex; flex-direction: column; gap: 8px;
  }
  .nav-item {
    display: flex; align-items: center; gap: 14px;
    padding: 14px 16px; border-radius: 12px;
    cursor: pointer; border: none; width: 100%;
    background: transparent; color: var(--muted);
    text-align: left; transition: all 0.2s;
    border-left: 3px solid transparent;
  }
  .nav-item:hover { background: var(--surface-high); color: var(--text); }
  .nav-item.active {
    background: var(--primary-dim);
    border-left-color: var(--primary-light);
    color: white;
  }
  .nav-icon {
    width: 36px; height: 36px; border-radius: 10px;
    display: flex; align-items: center; justify-content: center;
    background: rgba(51,65,85,0.5); font-size: 18px; flex-shrink: 0;
  }
  .nav-item.active .nav-icon { background: rgba(79,70,229,0.4); color: white; }
  .nav-label { font-size: 15px; font-weight: 600; }
  .nav-desc { font-size: 12px; opacity: 0.7; margin-top: 2px; font-weight: 400; }

  /* Content */
  .content { flex: 1; padding: 32px; overflow-y: auto; max-width: 1600px; margin: 0 auto; width: 100%; }
  .page-header { display: flex; align-items: center; gap: 16px; margin-bottom: 32px; }
  .page-header-icon { font-size: 32px; }
  .page-title { font-size: 28px; font-weight: 700; letter-spacing: -0.02em; }
  .page-sub { font-size: 15px; color: var(--muted); margin-top: 4px; }

  /* Panels */
  .panel {
    background: var(--surface); border-radius: 18px;
    padding: 28px; border: 1px solid var(--border);
    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
  }
  /* NEW: Analysis Panel Style */
  .analysis-panel {
    background: linear-gradient(145deg, rgba(79,70,229,0.08), rgba(30,41,59,0.4));
    border: 1px solid rgba(129,140,248,0.2);
    margin-bottom: 24px;
  }
  .analysis-text {
    font-size: 15px; color: var(--text); line-height: 1.6;
  }
  .analysis-text strong { color: var(--primary-light); font-weight: 600; }
  
  .section-title {
    font-size: 13px; font-weight: 700; letter-spacing: 0.08em;
    text-transform: uppercase; color: var(--text);
    border-left: 4px solid var(--primary); padding-left: 12px;
    margin: 0 0 24px; display: flex; align-items: center; gap: 8px;
  }

  /* Grid layouts */
  .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; }
  .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px; }
  .grid-col { display: flex; flex-direction: column; gap: 24px; }
  .calc-grid { display: grid; grid-template-columns: 400px 1fr; gap: 24px; }

  /* Stat Cards */
  .stat-card {
    background: var(--surface-high); border: 1px solid var(--border);
    border-radius: 14px; padding: 18px 22px;
  }
  .stat-card.accent {
    background: linear-gradient(135deg, rgba(79,70,229,0.2), rgba(129,140,248,0.05));
    border-color: rgba(129,140,248,0.3);
  }
  .stat-label { font-size: 12px; text-transform: uppercase; letter-spacing: 0.05em; color: var(--muted); font-weight: 600; }
  .stat-value {
    font-family: 'DM Mono', monospace; font-size: 28px; font-weight: 700;
    color: var(--text); margin-top: 8px; letter-spacing: -0.02em;
  }
  .stat-card.accent .stat-value { color: var(--primary-light); font-size: 36px; }
  .stat-sub { font-size: 13px; color: var(--muted); margin-top: 4px; }

  /* Slider Input */
  .input-group { display: flex; flex-direction: column; gap: 10px; margin-bottom: 24px; }
  .input-row { display: flex; justify-content: space-between; align-items: center; }
  .input-label { font-size: 13px; font-weight: 600; color: #cbd5e1; }
  .input-number {
    background: var(--input-bg); border: 1px solid var(--border);
    color: var(--input-color); border-radius: 8px; padding: 8px 12px;
    width: 140px; text-align: right; font-size: 16px; /* Larger input font */
    font-family: 'DM Mono', monospace; outline: none; transition: border 0.2s;
  }
  .input-number:focus { border-color: var(--primary-light); }
  
  input[type=range] {
    -webkit-appearance: none; width: 100%; height: 6px;
    border-radius: 99px; background: var(--surface-high); cursor: pointer;
    margin-top: 4px;
  }
  input[type=range]::-webkit-slider-thumb {
    -webkit-appearance: none; width: 20px; height: 20px; /* Larger thumb */
    border-radius: 50%; background: var(--primary);
    border: 3px solid var(--primary-light); cursor: pointer;
    box-shadow: 0 2px 6px rgba(0,0,0,0.3);
  }
  .range-hints { display: flex; justify-content: space-between; font-size: 12px; color: var(--muted); margin-top: 2px; }

  /* Toggle buttons */
  .toggle-group { display: flex; gap: 8px; margin-top: 8px; }
  .toggle-btn {
    flex: 1; padding: 10px; border-radius: 10px; cursor: pointer;
    border: 1px solid var(--border); background: transparent;
    color: var(--muted); font-size: 14px; font-family: 'DM Sans', sans-serif; font-weight: 500;
    transition: all 0.2s; text-transform: capitalize;
  }
  .toggle-btn.active {
    border-color: var(--primary); background: rgba(79,70,229,0.2);
    color: white;
  }

  /* Chart container */
  .chart-wrap { position: relative; width: 100%; margin-top: 10px; }

  /* Progress bar */
  .progress-bar-wrap { background: var(--surface-high); border-radius: 99px; height: 12px; overflow: hidden; margin-top: 10px; border: 1px solid var(--border); }
  .progress-bar-fill {
    height: 100%; border-radius: 99px;
    background: linear-gradient(90deg, var(--primary), var(--primary-light));
    transition: width 0.4s ease;
  }

  /* Table */
  .amort-table-wrap { max-height: 300px; overflow-y: auto; border-radius: 12px; border: 1px solid var(--border); margin-top: 24px; background: var(--surface-high); }
  table { width: 100%; border-collapse: collapse; font-size: 13px; font-family: 'DM Mono', monospace; }
  thead { position: sticky; top: 0; background: var(--slate); z-index: 10; }
  th { padding: 12px 14px; color: var(--muted); text-align: right; border-bottom: 1px solid var(--border); font-family: 'DM Sans', sans-serif; font-weight: 600; font-size: 12px; }
  td { padding: 10px 14px; text-align: right; border-bottom: 1px solid rgba(51,65,85,0.3); color: #cbd5e1; }
  tr:last-child td { border-bottom: none; }
  .col-principal { color: var(--primary-light); }
  .col-interest { color: var(--accent); }

  /* Footer note */
  .footer-note {
    margin-top: 32px; padding: 16px 20px; border-radius: 12px;
    background: rgba(30,41,59,0.4); border: 1px solid var(--border);
    display: flex; align-items: center; gap: 12px;
    font-size: 13px; color: var(--muted);
  }

  /* Calculator pages */
  .calc-page { display: none; animation: fadeIn 0.3s ease; }
  .calc-page.active { display: block; }
  @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

  /* Milestone cards */
  .milestone { background: var(--surface-high); border-radius: 12px; padding: 16px; border: 1px solid var(--border); }
  .milestone-year { font-size: 13px; color: var(--muted); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 4px; }
  .milestone-val { font-size: 20px; font-weight: 700; font-family: 'DM Mono', monospace; color: var(--emerald-light); }
  .milestone-sub { font-size: 12px; color: var(--muted); margin-top: 4px; }

  /* Theme toggle */
  .theme-btn {
    width: 38px; height: 38px; border-radius: 9px; cursor: pointer;
    border: 1px solid var(--border); background: var(--surface-high);
    display: flex; align-items: center; justify-content: center; font-size: 17px;
    transition: all 0.2s; flex-shrink: 0;
  }
  .theme-btn:hover { border-color: var(--primary); background: var(--surface); }
  .topbar-right { display: flex; align-items: center; gap: 12px; }

  /* News Sidebar */
  .news-sidebar {
    width: 280px; flex-shrink: 0;
    border-left: 1px solid var(--border);
    background: var(--news-bg);
    display: flex; flex-direction: column;
    overflow-y: auto; max-height: calc(100vh - 70px);
    position: sticky; top: 70px;
  }
  .news-section { border-bottom: 1px solid var(--border); }
  .news-section-header {
    padding: 14px 16px 10px;
    font-size: 11px; font-weight: 700; letter-spacing: 0.08em;
    text-transform: uppercase; color: var(--text);
    display: flex; align-items: center; gap: 8px;
    border-left: 3px solid var(--primary);
    margin: 12px 12px 4px;
    border-radius: 0 4px 4px 0;
  }
  .bank-card {
    margin: 6px 12px; padding: 12px 14px;
    background: var(--surface); border: 1px solid var(--border);
    border-radius: 10px; text-decoration: none; display: block;
    transition: all 0.15s;
  }
  .bank-card:hover { border-color: var(--primary); background: var(--surface-high); transform: translateY(-1px); }
  .bank-card-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px; }
  .bank-name { font-size: 13px; font-weight: 700; color: var(--text); }
  .bank-badge {
    font-size: 9px; padding: 2px 7px; border-radius: 99px;
    background: var(--primary-dim); color: var(--primary-light);
    border: 1px solid rgba(79,70,229,0.2); font-weight: 600; letter-spacing: 0.05em;
  }
  .rate-row { display: flex; justify-content: space-between; align-items: center; padding: 3px 0; border-bottom: 1px solid rgba(51,65,85,0.15); }
  .rate-row:last-child { border-bottom: none; }
  .rate-label { font-size: 11px; color: var(--muted); }
  .rate-value { font-size: 12px; font-weight: 600; font-family: 'DM Mono', monospace; color: var(--emerald-light); }
  :root.light .rate-value { color: var(--emerald); }
  .bank-link { font-size: 10px; color: var(--primary-light); margin-top: 6px; display: block; }
  :root.light .bank-link { color: var(--primary); }

  .news-item {
    margin: 6px 12px; padding: 11px 13px;
    background: var(--surface); border: 1px solid var(--border);
    border-radius: 10px; text-decoration: none; display: block;
    transition: all 0.15s;
  }
  .news-item:hover { border-color: var(--accent); transform: translateY(-1px); }
  .news-tag {
    display: inline-block; font-size: 9px; padding: 2px 7px; border-radius: 99px;
    font-weight: 700; letter-spacing: 0.06em; margin-bottom: 5px;
    text-transform: uppercase;
  }
  .tag-mortgage { background: rgba(79,70,229,0.2); color: var(--primary-light); }
  .tag-vehicle { background: rgba(16,185,129,0.2); color: var(--emerald-light); }
  :root.light .tag-vehicle { color: var(--emerald); }
  .tag-personal { background: rgba(245,158,11,0.2); color: var(--accent); }
  .tag-general { background: rgba(148,163,184,0.2); color: var(--muted); }
  .news-headline { font-size: 12px; font-weight: 600; color: var(--text); line-height: 1.4; margin-bottom: 4px; }
  .news-meta { font-size: 10px; color: var(--muted); }
  .news-source { color: var(--primary-light); font-weight: 500; }
  :root.light .news-source { color: var(--primary); }
  .news-last { padding: 10px 12px 14px; }
  .rbf-box {
    margin: 6px 12px 12px; padding: 12px 14px;
    background: linear-gradient(135deg, rgba(79,70,229,0.12), rgba(16,185,129,0.08));
    border: 1px solid rgba(79,70,229,0.25); border-radius: 10px;
  }
  .rbf-label { font-size: 10px; color: var(--muted); text-transform: uppercase; letter-spacing: 0.06em; }
  .rbf-rate { font-size: 22px; font-weight: 700; font-family: 'DM Mono', monospace; color: var(--primary-light); }
  :root.light .rbf-rate { color: var(--primary); }
  .rbf-sub { font-size: 11px; color: var(--muted); margin-top: 2px; }

  @media (max-width: 1200px) { .news-sidebar { display: none; } }
  @media (max-width: 768px) {
    .app-body { flex-direction: column; }
    .sidebar { width: 100%; flex-direction: row; overflow-x: auto; padding: 12px; border-right: none; border-bottom: 1px solid var(--border); gap: 12px; }
    .nav-desc { display: none; }
    .nav-item { padding: 10px; width: auto; flex-shrink: 0; }
    .content { padding: 20px; }
    .grid-2, .grid-3 { grid-template-columns: 1fr; }
    .topbar { padding: 0 16px; height: 60px; }
  }
</style>
</head>
<body>

<div class="topbar">
  <div class="topbar-brand">
    <div class="brand-icon">ğŸ’°</div>
    <div>
      <div class="brand-name">Finance Calculator</div>
      <div class="brand-sub">Fiji Financial Calculator Suite</div>
    </div>
  </div>
  <div class="topbar-right">
    <button class="theme-btn" id="theme-btn" onclick="toggleTheme()" title="Toggle dark/light mode">ğŸŒ™</button>
    <div class="live-badge">LIVE CALC</div>
  </div>
</div>

<div class="app-body">

  <nav class="sidebar">
    <button class="nav-item active" onclick="switchTab('mortgage', this)">
      <div class="nav-icon">ğŸ </div>
      <div><div class="nav-label">Mortgage</div><div class="nav-desc">Home Purchase Loan</div></div>
    </button>
    <button class="nav-item" onclick="switchTab('vehicle', this)">
      <div class="nav-icon">ğŸš—</div>
      <div><div class="nav-label">Vehicle</div><div class="nav-desc">Auto Financing</div></div>
    </button>
    <button class="nav-item" onclick="switchTab('personal', this)">
      <div class="nav-icon">ğŸ’³</div>
      <div><div class="nav-label">Personal Loan</div><div class="nav-desc">General Amortized</div></div>
    </button>
    <button class="nav-item" onclick="switchTab('savings', this)">
      <div class="nav-icon">ğŸ“ˆ</div>
      <div><div class="nav-label">Savings & Invest</div><div class="nav-desc">Compound Growth</div></div>
    </button>
  </nav>

  <main class="content">

    <div id="page-mortgage" class="calc-page active">
      <div class="page-header">
        <span class="page-header-icon">ğŸ </span>
        <div>
          <div class="page-title">Mortgage Calculator</div>
          <div class="page-sub">Home Purchase Loan â€” adjust parameters to see real-time results</div>
        </div>
      </div>
      <div class="calc-grid">
        <div class="panel">
          <div class="section-title">Loan Parameters</div>
          <div class="input-group">
            <div class="input-row"><span class="input-label">Home Price</span><input class="input-number" type="number" id="m-price" value="450000" oninput="syncSlider('m-price','ms-price');calcMortgage()"/></div>
            <input type="range" id="ms-price" min="100000" max="2000000" step="5000" value="450000" oninput="syncInput('ms-price','m-price');calcMortgage()"/>
            <div class="range-hints"><span>$100k</span><span>$2M</span></div>
          </div>
          <div class="input-group">
            <div class="input-row"><span class="input-label">Down Payment %</span><input class="input-number" type="number" id="m-down" value="20" oninput="syncSlider('m-down','ms-down');calcMortgage()"/></div>
            <input type="range" id="ms-down" min="3" max="50" step="0.5" value="20" oninput="syncInput('ms-down','m-down');calcMortgage()"/>
            <div class="range-hints"><span>3%</span><span>50%</span></div>
          </div>
          <div class="input-group">
            <div class="input-row"><span class="input-label">Interest Rate %</span><input class="input-number" type="number" id="m-rate" value="6.75" step="0.05" oninput="syncSlider('m-rate','ms-rate');calcMortgage()"/></div>
            <input type="range" id="ms-rate" min="2" max="15" step="0.05" value="6.75" oninput="syncInput('ms-rate','m-rate');calcMortgage()"/>
            <div class="range-hints"><span>2%</span><span>15%</span></div>
          </div>
          <div class="input-group">
            <div class="input-row"><span class="input-label">Loan Term (years)</span><input class="input-number" type="number" id="m-term" value="30" oninput="syncSlider('m-term','ms-term');calcMortgage()"/></div>
            <input type="range" id="ms-term" min="5" max="30" step="5" value="30" oninput="syncInput('ms-term','m-term');calcMortgage()"/>
            <div class="range-hints"><span>5 yrs</span><span>30 yrs</span></div>
          </div>
          <div class="input-group">
            <div class="input-row"><span class="input-label">Annual Property Tax</span><input class="input-number" type="number" id="m-tax" value="4500" oninput="syncSlider('m-tax','ms-tax');calcMortgage()"/></div>
            <input type="range" id="ms-tax" min="0" max="30000" step="100" value="4500" oninput="syncInput('ms-tax','m-tax');calcMortgage()"/>
            <div class="range-hints"><span>$0</span><span>$30k</span></div>
          </div>
          <div class="input-group">
            <div class="input-row"><span class="input-label">Annual Insurance</span><input class="input-number" type="number" id="m-ins" value="1800" oninput="syncSlider('m-ins','ms-ins');calcMortgage()"/></div>
            <input type="range" id="ms-ins" min="0" max="10000" step="100" value="1800" oninput="syncInput('ms-ins','m-ins');calcMortgage()"/>
            <div class="range-hints"><span>$0</span><span>$10k</span></div>
          </div>
        </div>

        <div class="grid-col">
          <div class="panel analysis-panel">
            <div class="section-title">âœ¨ Smart Analysis</div>
            <div class="analysis-text" id="m-analysis"></div>
          </div>

          <div class="panel">
            <div class="section-title">Monthly Breakdown</div>
            <div class="stat-card accent" style="margin-bottom:16px">
              <div class="stat-label">Principal & Interest Payment</div>
              <div class="stat-value" id="m-out-pi">$2,484</div>
            </div>
            <div class="grid-2" style="gap:16px">
              <div class="stat-card"><div class="stat-label">Total Monthly</div><div class="stat-value" id="m-out-total">$2,984</div></div>
              <div class="stat-card"><div class="stat-label">Loan Amount</div><div class="stat-value" id="m-out-loan">$360,000</div></div>
              <div class="stat-card"><div class="stat-label">Total Interest</div><div class="stat-value" id="m-out-interest">$534,407</div></div>
              <div class="stat-card"><div class="stat-label">Total Cost</div><div class="stat-value" id="m-out-cost">$984,407</div></div>
            </div>
          </div>
          <div class="panel">
            <div class="section-title">Amortization â€” Annual Overview</div>
            <div class="chart-wrap"><canvas id="chart-mortgage" height="180"></canvas></div>
          </div>
        </div>
      </div>
      <div class="footer-note">â„¹ï¸ Calculations are estimates for illustrative purposes only. Consult a licensed financial advisor before making financial decisions.</div>
    </div>

    <div id="page-vehicle" class="calc-page">
      <div class="page-header">
        <span class="page-header-icon">ğŸš—</span>
        <div>
          <div class="page-title">Vehicle Loan Calculator</div>
          <div class="page-sub">Auto Financing â€” adjust parameters to see real-time results</div>
        </div>
      </div>
      <div class="calc-grid">
        <div class="panel">
          <div class="section-title">Vehicle Details</div>
          <div class="input-group">
            <div class="input-row"><span class="input-label">Vehicle Price</span><input class="input-number" type="number" id="v-price" value="35000" oninput="syncSlider('v-price','vs-price');calcVehicle()"/></div>
            <input type="range" id="vs-price" min="5000" max="200000" step="500" value="35000" oninput="syncInput('vs-price','v-price');calcVehicle()"/>
            <div class="range-hints"><span>$5k</span><span>$200k</span></div>
          </div>
          <div class="input-group">
            <div class="input-row"><span class="input-label">Trade-in Value</span><input class="input-number" type="number" id="v-tradein" value="5000" oninput="syncSlider('v-tradein','vs-tradein');calcVehicle()"/></div>
            <input type="range" id="vs-tradein" min="0" max="50000" step="500" value="5000" oninput="syncInput('vs-tradein','v-tradein');calcVehicle()"/>
            <div class="range-hints"><span>$0</span><span>$50k</span></div>
          </div>
          <div class="input-group">
            <div class="input-row"><span class="input-label">Down Payment</span><input class="input-number" type="number" id="v-down" value="3000" oninput="syncSlider('v-down','vs-down');calcVehicle()"/></div>
            <input type="range" id="vs-down" min="0" max="50000" step="500" value="3000" oninput="syncInput('vs-down','v-down');calcVehicle()"/>
            <div class="range-hints"><span>$0</span><span>$50k</span></div>
          </div>
          <div class="input-group">
            <div class="input-row"><span class="input-label">Sales Tax Rate %</span><input class="input-number" type="number" id="v-tax" value="7" step="0.25" oninput="syncSlider('v-tax','vs-tax');calcVehicle()"/></div>
            <input type="range" id="vs-tax" min="0" max="15" step="0.25" value="7" oninput="syncInput('vs-tax','v-tax');calcVehicle()"/>
            <div class="range-hints"><span>0%</span><span>15%</span></div>
          </div>
          <div class="input-group">
            <div class="input-row"><span class="input-label">Interest Rate %</span><input class="input-number" type="number" id="v-rate" value="5.9" step="0.1" oninput="syncSlider('v-rate','vs-rate');calcVehicle()"/></div>
            <input type="range" id="vs-rate" min="1" max="25" step="0.1" value="5.9" oninput="syncInput('vs-rate','v-rate');calcVehicle()"/>
            <div class="range-hints"><span>1%</span><span>25%</span></div>
          </div>
          <div class="input-group">
            <div class="input-row"><span class="input-label">Loan Term (months)</span><input class="input-number" type="number" id="v-term" value="60" oninput="syncSlider('v-term','vs-term');calcVehicle()"/></div>
            <input type="range" id="vs-term" min="12" max="84" step="12" value="60" oninput="syncInput('vs-term','v-term');calcVehicle()"/>
            <div class="range-hints"><span>12 mo</span><span>84 mo</span></div>
          </div>
        </div>
        <div class="grid-col">
          <div class="panel analysis-panel">
            <div class="section-title">âœ¨ Smart Analysis</div>
            <div class="analysis-text" id="v-analysis"></div>
          </div>

          <div class="panel">
            <div class="section-title">Summary</div>
            <div class="stat-card accent" style="margin-bottom:16px">
              <div class="stat-label">Monthly Payment</div>
              <div class="stat-value" id="v-out-monthly">$521</div>
            </div>
            <div class="grid-3">
              <div class="stat-card"><div class="stat-label">Loan Amount</div><div class="stat-value" id="v-out-loan">$28,890</div></div>
              <div class="stat-card"><div class="stat-label">Sales Tax</div><div class="stat-value" id="v-out-tax">$2,100</div></div>
              <div class="stat-card"><div class="stat-label">Total Interest</div><div class="stat-value" id="v-out-interest">$4,374</div></div>
            </div>
          </div>
          <div class="panel" style="flex:1">
            <div class="section-title">Loan Balance Over Time</div>
            <div class="chart-wrap"><canvas id="chart-vehicle" height="200"></canvas></div>
          </div>
        </div>
      </div>
      <div class="footer-note">â„¹ï¸ Calculations are estimates for illustrative purposes only. Consult a licensed financial advisor before making financial decisions.</div>
    </div>

    <div id="page-personal" class="calc-page">
      <div class="page-header">
        <span class="page-header-icon">ğŸ’³</span>
        <div>
          <div class="page-title">Personal Loan Calculator</div>
          <div class="page-sub">General Amortized Loan â€” adjust parameters to see real-time results</div>
        </div>
      </div>
      <div class="calc-grid">
        <div class="grid-col">
          <div class="panel">
            <div class="section-title">Loan Parameters</div>
            <div class="input-group">
              <div class="input-row"><span class="input-label">Loan Amount</span><input class="input-number" type="number" id="p-amount" value="15000" oninput="syncSlider('p-amount','ps-amount');calcPersonal()"/></div>
              <input type="range" id="ps-amount" min="1000" max="100000" step="500" value="15000" oninput="syncInput('ps-amount','p-amount');calcPersonal()"/>
              <div class="range-hints"><span>$1k</span><span>$100k</span></div>
            </div>
            <div class="input-group">
              <div class="input-row"><span class="input-label">Annual Interest Rate %</span><input class="input-number" type="number" id="p-rate" value="11.5" step="0.25" oninput="syncSlider('p-rate','ps-rate');calcPersonal()"/></div>
              <input type="range" id="ps-rate" min="1" max="36" step="0.25" value="11.5" oninput="syncInput('ps-rate','p-rate');calcPersonal()"/>
              <div class="range-hints"><span>1%</span><span>36%</span></div>
            </div>
            <div class="input-group">
              <div class="input-row"><span class="input-label">Loan Term (months)</span><input class="input-number" type="number" id="p-term" value="36" oninput="syncSlider('p-term','ps-term');calcPersonal()"/></div>
              <input type="range" id="ps-term" min="6" max="84" step="6" value="36" oninput="syncInput('ps-term','p-term');calcPersonal()"/>
              <div class="range-hints"><span>6 mo</span><span>84 mo</span></div>
            </div>
          </div>

          <div class="panel analysis-panel">
            <div class="section-title">âœ¨ Smart Analysis</div>
            <div class="analysis-text" id="p-analysis"></div>
          </div>

          <div class="panel">
            <div class="section-title">Results</div>
            <div class="stat-card accent" style="margin-bottom:16px">
              <div class="stat-label">Monthly Payment</div>
              <div class="stat-value" id="p-out-monthly">$493</div>
            </div>
            <div class="grid-2" style="gap:16px;margin-bottom:20px">
              <div class="stat-card"><div class="stat-label">Total Interest</div><div class="stat-value" id="p-out-interest">$2,741</div></div>
              <div class="stat-card"><div class="stat-label">Total Paid</div><div class="stat-value" id="p-out-total">$17,741</div></div>
            </div>
            <div style="padding:18px;background:var(--slate);border-radius:12px;border:1px solid var(--border)">
              <div style="color:var(--muted);font-size:13px;margin-bottom:8px">Interest as % of Loan</div>
              <div class="progress-bar-wrap"><div class="progress-bar-fill" id="p-out-bar" style="width:18%"></div></div>
              <div style="color:var(--primary-light);font-size:14px;margin-top:8px;font-family:'DM Mono',monospace" id="p-out-pct">18.3%</div>
            </div>
          </div>
        </div>
        <div class="panel">
          <div class="section-title">Monthly Amortization</div>
          <div class="chart-wrap"><canvas id="chart-personal" height="240"></canvas></div>
          <div class="amort-table-wrap">
            <table>
              <thead><tr><th>Mo</th><th>Payment</th><th>Principal</th><th>Interest</th><th>Balance</th></tr></thead>
              <tbody id="p-table"></tbody>
            </table>
          </div>
        </div>
      </div>
      <div class="footer-note">â„¹ï¸ Calculations are estimates for illustrative purposes only. Consult a licensed financial advisor before making financial decisions.</div>
    </div>

    <div id="page-savings" class="calc-page">
      <div class="page-header">
        <span class="page-header-icon">ğŸ“ˆ</span>
        <div>
          <div class="page-title">Savings & Investment Calculator</div>
          <div class="page-sub">Compound Growth â€” adjust parameters to see real-time results</div>
        </div>
      </div>
      <div class="calc-grid">
        <div class="grid-col">
          <div class="panel">
            <div class="section-title">Investment Parameters</div>
            <div class="input-group">
              <div class="input-row"><span class="input-label">Initial Deposit</span><input class="input-number" type="number" id="s-initial" value="10000" oninput="syncSlider('s-initial','ss-initial');calcSavings()"/></div>
              <input type="range" id="ss-initial" min="0" max="500000" step="1000" value="10000" oninput="syncInput('ss-initial','s-initial');calcSavings()"/>
              <div class="range-hints"><span>$0</span><span>$500k</span></div>
            </div>
            <div class="input-group">
              <div class="input-row"><span class="input-label">Monthly Contribution</span><input class="input-number" type="number" id="s-monthly" value="500" oninput="syncSlider('s-monthly','ss-monthly');calcSavings()"/></div>
              <input type="range" id="ss-monthly" min="0" max="10000" step="50" value="500" oninput="syncInput('ss-monthly','s-monthly');calcSavings()"/>
              <div class="range-hints"><span>$0</span><span>$10k</span></div>
            </div>
            <div class="input-group">
              <div class="input-row"><span class="input-label">Annual Return Rate %</span><input class="input-number" type="number" id="s-rate" value="8" step="0.25" oninput="syncSlider('s-rate','ss-rate');calcSavings()"/></div>
              <input type="range" id="ss-rate" min="1" max="20" step="0.25" value="8" oninput="syncInput('ss-rate','s-rate');calcSavings()"/>
              <div class="range-hints"><span>1%</span><span>20%</span></div>
            </div>
            <div class="input-group">
              <div class="input-row"><span class="input-label">Time Horizon (years)</span><input class="input-number" type="number" id="s-years" value="20" oninput="syncSlider('s-years','ss-years');calcSavings()"/></div>
              <input type="range" id="ss-years" min="1" max="50" step="1" value="20" oninput="syncInput('ss-years','s-years');calcSavings()"/>
              <div class="range-hints"><span>1 yr</span><span>50 yrs</span></div>
            </div>
            <div>
              <div class="input-label" style="margin-bottom:8px">Compound Frequency</div>
              <div class="toggle-group">
                <button class="toggle-btn active" id="freq-monthly" onclick="setFreq('monthly')">Monthly</button>
                <button class="toggle-btn" id="freq-annually" onclick="setFreq('annually')">Annually</button>
              </div>
            </div>
          </div>
          
          <div class="panel analysis-panel">
            <div class="section-title">âœ¨ Smart Analysis</div>
            <div class="analysis-text" id="s-analysis"></div>
          </div>

          <div class="panel">
            <div class="section-title">Outcome</div>
            <div class="stat-card accent" style="margin-bottom:16px">
              <div class="stat-label">Final Portfolio Value</div>
              <div class="stat-value" id="s-out-final">$589,020</div>
            </div>
            <div class="grid-2" style="gap:16px;margin-bottom:16px">
              <div class="stat-card"><div class="stat-label">Total Invested</div><div class="stat-value" id="s-out-contrib">$130,000</div></div>
              <div class="stat-card"><div class="stat-label">Total Growth</div><div class="stat-value" id="s-out-growth" style="color:var(--emerald-light)">$459,020</div></div>
            </div>
            <div id="s-milestones" class="grid-3" style="gap:12px"></div>
          </div>
        </div>
        <div class="panel">
          <div class="section-title">Wealth Growth Projection</div>
          <div class="chart-wrap"><canvas id="chart-savings" height="300"></canvas></div>
        </div>
      </div>
      <div class="footer-note">â„¹ï¸ Calculations are estimates for illustrative purposes only. Consult a licensed financial advisor before making financial decisions.</div>
    </div>

  </main>

  <!-- â•â•â• NEWS SIDEBAR â•â•â• -->
  <aside class="news-sidebar">

    <!-- RBF Base Rate -->
    <div style="padding:14px 12px 0">
      <div class="rbf-box">
        <div class="rbf-label">ğŸ¦ RBF Base Lending Rate</div>
        <div class="rbf-rate">1.67%</div>
        <div class="rbf-sub">p.a. â€” Q1 2025 Â· Reserve Bank of Fiji</div>
      </div>
    </div>

    <!-- LOCAL BANK RATES -->
    <div class="news-section">
      <div class="news-section-header">ğŸ›ï¸ Local Bank Rates</div>

      <!-- ANZ -->
      <a class="bank-card" href="https://www.anz.com/fiji/en/interest-rates/" target="_blank">
        <div class="bank-card-header">
          <span class="bank-name">ANZ Fiji</span>
          <span class="bank-badge">DEC 2025</span>
        </div>
        <div class="rate-row"><span class="rate-label">ğŸ  Home Loan (Variable)</span><span class="rate-value">6.49%</span></div>
        <div class="rate-row"><span class="rate-label">ğŸ  Home Loan (1yr Fixed)</span><span class="rate-value">3.95%</span></div>
        <div class="rate-row"><span class="rate-label">ğŸ  Home Loan (2yr Fixed)</span><span class="rate-value">4.95%</span></div>
        <div class="rate-row"><span class="rate-label">ğŸš— Car Loan</span><span class="rate-value">8.45%</span></div>
        <div class="rate-row"><span class="rate-label">ğŸ’³ Personal (Secured)</span><span class="rate-value">10.50%</span></div>
        <div class="rate-row"><span class="rate-label">ğŸ’³ Personal (Unsecured)</span><span class="rate-value">16.50%</span></div>
        <span class="bank-link">â†’ View full rates at anz.com/fiji</span>
      </a>

      <!-- Westpac -->
      <a class="bank-card" href="https://www.westpac.com.fj/" target="_blank">
        <div class="bank-card-header">
          <span class="bank-name">Westpac Fiji</span>
          <span class="bank-badge">JAN 2026</span>
        </div>
        <div class="rate-row"><span class="rate-label">ğŸ  Home Loan (1yr Fixed)</span><span class="rate-value">4.75%</span></div>
        <div class="rate-row"><span class="rate-label">ğŸ  Home Loan (2yr Fixed)</span><span class="rate-value">5.45%</span></div>
        <div class="rate-row"><span class="rate-label">ğŸ  Home Loan (Variable)</span><span class="rate-value">7.49%</span></div>
        <div class="rate-row"><span class="rate-label">ğŸš— Vehicle (1yr Fixed)</span><span class="rate-value">4.75%</span></div>
        <div class="rate-row"><span class="rate-label">ğŸš— Vehicle (Variable)</span><span class="rate-value">6.49%</span></div>
        <div class="rate-row"><span class="rate-label">ğŸ’³ Personal (Secured)</span><span class="rate-value">10.45%</span></div>
        <div class="rate-row"><span class="rate-label">ğŸ’³ Personal (Unsecured)</span><span class="rate-value">16.50%</span></div>
        <span class="bank-link">â†’ View full rates at westpac.com.fj</span>
      </a>

      <!-- BSP -->
      <a class="bank-card" href="https://www.bsp.com.fj/help/indicated-lending-rates/" target="_blank">
        <div class="bank-card-header">
          <span class="bank-name">BSP Fiji</span>
          <span class="bank-badge">2025</span>
        </div>
        <div class="rate-row"><span class="rate-label">ğŸ  Home Loan (EasyHome)</span><span class="rate-value">Contact BSP</span></div>
        <div class="rate-row"><span class="rate-label">ğŸ  Home Loan (1yr Fixed)</span><span class="rate-value">4.10%</span></div>
        <div class="rate-row"><span class="rate-label">ğŸ  Home Loan (2yr Fixed)</span><span class="rate-value">4.90%</span></div>
        <div class="rate-row"><span class="rate-label">ğŸš— Motor Vehicle</span><span class="rate-value">Contact BSP</span></div>
        <div class="rate-row"><span class="rate-label">ğŸ’³ Personal (Secured)</span><span class="rate-value">Contact BSP</span></div>
        <span class="bank-link">â†’ View full rates at bsp.com.fj</span>
      </a>

      <!-- HFC -->
      <a class="bank-card" href="https://www.hfc.com.fj/current-interest-rates-3/" target="_blank">
        <div class="bank-card-header">
          <span class="bank-name">HFC Bank</span>
          <span class="bank-badge">2025</span>
        </div>
        <div class="rate-row"><span class="rate-label">ğŸ  Super Dream Home</span><span class="rate-value">Competitive</span></div>
        <div class="rate-row"><span class="rate-label">ğŸ  Dream Home Package</span><span class="rate-value">Competitive</span></div>
        <div class="rate-row"><span class="rate-label">ğŸš— Motor Vehicle</span><span class="rate-value">Contact HFC</span></div>
        <div class="rate-row"><span class="rate-label">ğŸ’³ Personal Loan</span><span class="rate-value">Contact HFC</span></div>
        <span class="bank-link">â†’ View full rates at hfc.com.fj</span>
      </a>

      <!-- FDB -->
      <a class="bank-card" href="https://www.fdb.com.fj/" target="_blank">
        <div class="bank-card-header">
          <span class="bank-name">FDB (Fiji Dev. Bank)</span>
          <span class="bank-badge">2025</span>
        </div>
        <div class="rate-row"><span class="rate-label">ğŸ  Choice Home Loan</span><span class="rate-value">from 3.99%</span></div>
        <div class="rate-row"><span class="rate-label">ğŸ  No internal fees</span><span class="rate-value">First 6 mo</span></div>
        <div class="rate-row"><span class="rate-label">ğŸ‘¤ Focus: Youth/Women/Rural</span><span class="rate-value">âœ“</span></div>
        <span class="bank-link">â†’ View products at fdb.com.fj</span>
      </a>

      <!-- Merchant Finance -->
      <a class="bank-card" href="https://merchantfinance.com.fj/" target="_blank">
        <div class="bank-card-header">
          <span class="bank-name">Merchant Finance</span>
          <span class="bank-badge">2025</span>
        </div>
        <div class="rate-row"><span class="rate-label">ğŸ  Zero-Deposit Home Loan</span><span class="rate-value">âœ“ Available</span></div>
        <div class="rate-row"><span class="rate-label">ğŸ  Up to 90% financing</span><span class="rate-value">Construction</span></div>
        <div class="rate-row"><span class="rate-label">ğŸš— Motor Vehicle</span><span class="rate-value">Contact MFL</span></div>
        <span class="bank-link">â†’ View products at merchantfinance.com.fj</span>
      </a>
    </div>

    <!-- FIJI LOAN NEWS -->
    <div class="news-section">
      <div class="news-section-header">ğŸ“° Fiji Loan News</div>

      <a class="news-item" href="https://www.fbcnews.com.fj/news/new-loan-products-to-boost-homes-and-businesses/" target="_blank">
        <span class="news-tag tag-mortgage">Mortgage</span>
        <div class="news-headline">FDB launches Choice Home Loan with rates from 3.99% â€” targets youth, women & rural communities</div>
        <div class="news-meta"><span class="news-source">FBC News</span> Â· 2025</div>
      </a>

      <a class="news-item" href="https://www.fijivillage.com/news/Zero-dollar-deposit-on-home-loans-from-Merchant-Finance-f8xr45/" target="_blank">
        <span class="news-tag tag-mortgage">Mortgage</span>
        <div class="news-headline">Merchant Finance launches zero-deposit home loan â€” first of its kind in Fiji market</div>
        <div class="news-meta"><span class="news-source">Fijivillage</span> Â· 2025</div>
      </a>

      <a class="news-item" href="https://www.fijitimes.com.fj/new-housing-loan/" target="_blank">
        <span class="news-tag tag-mortgage">Mortgage</span>
        <div class="news-headline">BSP introduces new housing loan with 1-yr fixed rate of 4.10% p.a. to stimulate real estate sector</div>
        <div class="news-meta"><span class="news-source">Fiji Times</span> Â· 2023</div>
      </a>

      <a class="news-item" href="https://www.anz.com/fiji/en/interest-rates/" target="_blank">
        <span class="news-tag tag-vehicle">Vehicle</span>
        <div class="news-headline">ANZ Fiji car loan rate at 8.45% p.a. â€” among the most competitive vehicle financing rates in Fiji</div>
        <div class="news-meta"><span class="news-source">ANZ Fiji</span> Â· Dec 2025</div>
      </a>

      <a class="news-item" href="https://www.westpac.com.fj/content/dam/public/fiji/documents/Westpac_Fiji_Published_Interest_Rates.pdf" target="_blank">
        <span class="news-tag tag-vehicle">Vehicle</span>
        <div class="news-headline">Westpac Fiji vehicle loan 1-yr fixed rate drops to 4.75% â€” updated Jan 2026 rate sheet</div>
        <div class="news-meta"><span class="news-source">Westpac Fiji</span> Â· Jan 2026</div>
      </a>

      <a class="news-item" href="https://www.kontikifinance.com/" target="_blank">
        <span class="news-tag tag-personal">Personal</span>
        <div class="news-headline">Kontiki Finance offers flexible debt consolidation & vehicle loans with fixed rates and fast approvals</div>
        <div class="news-meta"><span class="news-source">Kontiki Finance</span> Â· 2025</div>
      </a>

      <a class="news-item" href="https://www.anz.com/fiji/en/interest-rates/" target="_blank">
        <span class="news-tag tag-personal">Personal</span>
        <div class="news-headline">ANZ Fiji personal loan rates: secured 10.50%, unsecured 16.50% â€” current from Dec 2025</div>
        <div class="news-meta"><span class="news-source">ANZ Fiji</span> Â· Dec 2025</div>
      </a>

      <a class="news-item" href="https://www.bankofbaroda-fiji.com/personal-banking/retail-loans/baroda-car-loans" target="_blank">
        <span class="news-tag tag-vehicle">Vehicle</span>
        <div class="news-headline">Bank of Baroda Fiji offers Baroda Car Loan for Fiji citizens â€” repayments capped at 60% of net salary</div>
        <div class="news-meta"><span class="news-source">Bank of Baroda</span> Â· 2025</div>
      </a>

    </div>

    <div class="news-last" style="text-align:center;color:var(--muted);font-size:11px;padding:14px 12px;">
      âš ï¸ Rates are indicative only. Verify directly with each bank before applying. All amounts in FJD.
    </div>

  </aside>

</div>

<script>
// â”€â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const $ = id => document.getElementById(id);
const fmt = (n, d=0) => new Intl.NumberFormat('en-US',{style:'currency',currency:'USD',maximumFractionDigits:d}).format(n);
const fmtK = n => n >= 1e6 ? `$${(n/1e6).toFixed(1)}M` : `$${(n/1000).toFixed(0)}k`;

function syncSlider(inputId, sliderId) {
  const v = parseFloat($(inputId).value) || 0;
  $(sliderId).value = v;
}
function syncInput(sliderId, inputId) {
  $(inputId).value = $(sliderId).value;
}

function monthlyPayment(principal, annualRate, termMonths) {
  if (annualRate === 0) return principal / termMonths;
  const r = annualRate / 100 / 12;
  return (principal * r * Math.pow(1+r, termMonths)) / (Math.pow(1+r, termMonths) - 1);
}

function buildAmortization(principal, annualRate, termMonths) {
  const r = annualRate / 100 / 12;
  let bal = principal;
  const pmt = monthlyPayment(principal, annualRate, termMonths);
  return Array.from({length: termMonths}, (_, i) => {
    const interest = bal * r;
    const princ = pmt - interest;
    bal = Math.max(0, bal - princ);
    return { month: i+1, interest, principal: princ, balance: bal };
  });
}

// â”€â”€â”€ Chart Registry â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const charts = {};
function makeChart(id, config) {
  if (charts[id]) charts[id].destroy();
  charts[id] = new Chart($(id), config);
}

const gridColor = 'rgba(51,65,85,0.5)';
const tickColor = '#94A3B8';
const baseChartOpts = {
  responsive: true,
  maintainAspectRatio: false,
  plugins: { legend: { labels: { color: tickColor, font: { family: 'DM Sans', size:12 }, boxWidth: 12 } }, tooltip: { backgroundColor: '#1E293B', borderColor: '#334155', borderWidth: 1, titleColor: '#F1F5F9', bodyColor: '#94A3B8', titleFont: {size:14}, bodyFont: {size:13} } },
  scales: {
    x: { grid: { color: gridColor }, ticks: { color: tickColor, font: { family: 'DM Mono', size: 12 } } },
    y: { grid: { color: gridColor }, ticks: { color: tickColor, font: { family: 'DM Mono', size: 12 } } }
  }
};

// â”€â”€â”€ MORTGAGE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function calcMortgage() {
  const price  = parseFloat($('m-price').value) || 0;
  const downP  = parseFloat($('m-down').value) || 0;
  const rate   = parseFloat($('m-rate').value) || 0;
  const term   = parseInt($('m-term').value) || 30;
  const tax    = parseFloat($('m-tax').value) || 0;
  const ins    = parseFloat($('m-ins').value) || 0;

  const down   = price * downP / 100;
  const loan   = price - down;
  const months = term * 12;
  const pi     = monthlyPayment(loan, rate, months);
  const totalMonthly = pi + tax/12 + ins/12;
  const totalPaid    = pi * months;
  const totalInterest = totalPaid - loan;

  $('m-out-pi').textContent       = fmt(pi);
  $('m-out-total').textContent    = fmt(totalMonthly);
  $('m-out-loan').textContent     = fmt(loan);
  $('m-out-interest').textContent = fmt(totalInterest);
  $('m-out-cost').textContent     = fmt(totalPaid + down);

  // Summary Logic
  const intPct = ((totalInterest / loan) * 100).toFixed(0);
  $('m-analysis').innerHTML = `
    With a <strong>${downP}% down payment</strong> ($${fmtK(down)}), you will borrow <strong>${fmt(loan)}</strong>. 
    Over ${term} years, you will pay <strong>${fmt(totalInterest)}</strong> in interest, which is roughly <strong>${intPct}%</strong> of the loan amount. 
    Your estimated monthly payment including taxes and insurance is <strong>${fmt(totalMonthly)}</strong>.
  `;

  // Annual chart data
  const schedule = buildAmortization(loan, rate, months);
  const labels = [], intData = [], princData = [];
  for (let y = 1; y <= term; y++) {
    const slice = schedule.slice((y-1)*12, y*12);
    labels.push(`Yr ${y}`);
    intData.push(Math.round(slice.reduce((s,r) => s+r.interest, 0)));
    princData.push(Math.round(slice.reduce((s,r) => s+r.principal, 0)));
  }

  makeChart('chart-mortgage', {
    type: 'bar',
    data: {
      labels,
      datasets: [
        { label: 'Interest', data: intData, backgroundColor: 'rgba(245,158,11,0.7)', borderColor: '#F59E0B', borderWidth: 1, borderRadius: 4 },
        { label: 'Principal', data: princData, backgroundColor: 'rgba(79,70,229,0.7)', borderColor: '#4F46E5', borderWidth: 1, borderRadius: 4 }
      ]
    },
    options: { ...baseChartOpts, scales: { ...baseChartOpts.scales, y: { ...baseChartOpts.scales.y, ticks: { ...baseChartOpts.scales.y.ticks, callback: v => fmtK(v) } } } }
  });
}

// â”€â”€â”€ VEHICLE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function calcVehicle() {
  const price   = parseFloat($('v-price').value) || 0;
  const tradein = parseFloat($('v-tradein').value) || 0;
  const down    = parseFloat($('v-down').value) || 0;
  const taxRate = parseFloat($('v-tax').value) || 0;
  const rate    = parseFloat($('v-rate').value) || 0;
  const term    = parseInt($('v-term').value) || 60;

  const taxAmt  = (price - tradein) * taxRate / 100;
  const loan    = Math.max(0, price - tradein - down + taxAmt);
  const monthly = monthlyPayment(loan, rate, term);
  const totalInterest = monthly * term - loan;

  $('v-out-monthly').textContent  = fmt(monthly);
  $('v-out-loan').textContent     = fmt(loan);
  $('v-out-tax').textContent      = fmt(taxAmt);
  $('v-out-interest').textContent = fmt(Math.max(0, totalInterest));

  // Summary Logic
  $('v-analysis').innerHTML = `
    After trade-in and a down payment of <strong>${fmt(down)}</strong>, you are financing <strong>${fmt(loan)}</strong> (including sales tax). 
    Your monthly payment will be <strong>${fmt(monthly)}</strong> for ${term} months. 
    By the end of the loan, you will have paid <strong>${fmt(totalInterest)}</strong> in interest charges.
  `;

  const schedule = buildAmortization(loan, rate, term);
  const step = Math.max(1, Math.floor(term / 20));
  const labels = [], balData = [];
  schedule.filter((_,i) => i % step === 0 || i === term-1).forEach(r => {
    labels.push(`M${r.month}`);
    balData.push(Math.round(r.balance));
  });

  makeChart('chart-vehicle', {
    type: 'line',
    data: {
      labels,
      datasets: [{ label: 'Remaining Balance', data: balData, borderColor: '#10B981', backgroundColor: 'rgba(16,185,129,0.1)', fill: true, tension: 0.4, pointRadius: 3, borderWidth: 3 }]
    },
    options: { ...baseChartOpts, scales: { ...baseChartOpts.scales, y: { ...baseChartOpts.scales.y, ticks: { ...baseChartOpts.scales.y.ticks, callback: v => fmtK(v) } } } }
  });
}

// â”€â”€â”€ PERSONAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function calcPersonal() {
  const amount = parseFloat($('p-amount').value) || 0;
  const rate   = parseFloat($('p-rate').value) || 0;
  const term   = parseInt($('p-term').value) || 36;

  const monthly = monthlyPayment(amount, rate, term);
  const totalPaid = monthly * term;
  const totalInterest = totalPaid - amount;
  const pct = (totalInterest / amount) * 100;

  $('p-out-monthly').textContent  = fmt(monthly);
  $('p-out-interest').textContent = fmt(totalInterest);
  $('p-out-total').textContent    = fmt(totalPaid);
  $('p-out-pct').textContent      = `${pct.toFixed(1)}%`;
  $('p-out-bar').style.width      = `${Math.min(100, pct).toFixed(1)}%`;

  // Summary Logic
  $('p-analysis').innerHTML = `
    To borrow <strong>${fmt(amount)}</strong> over ${term} months at ${rate}%, you will need to pay <strong>${fmt(monthly)}</strong> per month. 
    The total cost of this loan (interest) is <strong>${fmt(totalInterest)}</strong>, bringing your total repayment to <strong>${fmt(totalPaid)}</strong>.
  `;

  const schedule = buildAmortization(amount, rate, term);

  // Chart
  const labels = schedule.map(r => r.month);
  const princData = schedule.map(r => Math.round(r.principal));
  const intData   = schedule.map(r => Math.round(r.interest));

  makeChart('chart-personal', {
    type: 'bar',
    data: {
      labels,
      datasets: [
        { label: 'Principal', data: princData, backgroundColor: 'rgba(79,70,229,0.8)', borderRadius: 2, stack: 'a' },
        { label: 'Interest', data: intData, backgroundColor: 'rgba(245,158,11,0.7)', borderRadius: 2, stack: 'a' }
      ]
    },
    options: { ...baseChartOpts, scales: { ...baseChartOpts.scales, x: { ...baseChartOpts.scales.x, stacked: true }, y: { ...baseChartOpts.scales.y, stacked: true, ticks: { ...baseChartOpts.scales.y.ticks, callback: v => `$${v}` } } } }
  });

  // Table
  const tbody = $('p-table');
  tbody.innerHTML = schedule.map(r => `
    <tr>
      <td class="col-month">${r.month}</td>
      <td class="col-payment">${fmt(monthly)}</td>
      <td class="col-principal">${fmt(r.principal)}</td>
      <td class="col-interest">${fmt(r.interest)}</td>
      <td class="col-balance">${fmt(r.balance)}</td>
    </tr>`).join('');
}

// â”€â”€â”€ SAVINGS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let savingsFreq = 'monthly';
function setFreq(f) {
  savingsFreq = f;
  $('freq-monthly').classList.toggle('active', f === 'monthly');
  $('freq-annually').classList.toggle('active', f === 'annually');
  calcSavings();
}

function calcSavings() {
  const initial  = parseFloat($('s-initial').value) || 0;
  const monthly  = parseFloat($('s-monthly').value) || 0;
  const rate     = parseFloat($('s-rate').value) || 0;
  const years    = parseInt($('s-years').value) || 20;
  const n        = savingsFreq === 'monthly' ? 12 : 1;
  const r        = rate / 100;

  const labels = [], balData = [], contribData = [];
  let balance = initial, totalContrib = initial;
  labels.push('Now'); balData.push(Math.round(initial)); contribData.push(Math.round(initial));

  for (let y = 1; y <= years; y++) {
    for (let p = 0; p < n; p++) {
      balance = balance * (1 + r/n) + monthly * (12/n);
      totalContrib += monthly * (12/n);
    }
    labels.push(`Yr ${y}`);
    balData.push(Math.round(balance));
    contribData.push(Math.round(totalContrib));
  }

  const finalBal = balData[balData.length - 1];
  const finalContrib = contribData[contribData.length - 1];
  const growth = finalBal - finalContrib;

  $('s-out-final').textContent   = fmt(finalBal);
  $('s-out-contrib').textContent = fmt(finalContrib);
  $('s-out-growth').textContent  = fmt(Math.max(0, growth));

  // Summary Logic
  const multiplier = (finalBal / finalContrib).toFixed(1);
  $('s-analysis').innerHTML = `
    If you start with <strong>${fmt(initial)}</strong> and contribute <strong>${fmt(monthly)}/mo</strong> for ${years} years at ${rate}%, your portfolio could grow to <strong>${fmt(finalBal)}</strong>. 
    <br>That is <strong>${fmt(growth)}</strong> in pure investment earnings. Your money effectively multiplied by <strong>${multiplier}x</strong>.
  `;

  // Milestones
  const milestones = [5, 10, 20].filter(y => y <= years);
  $('s-milestones').innerHTML = milestones.map(y => {
    const idx = y; // year index matches label index
    const bal = balData[idx] || 0;
    const con = contribData[idx] || 0;
    return `<div class="milestone">
      <div class="milestone-year">Year ${y}</div>
      <div class="milestone-val">${fmt(bal)}</div>
      <div class="milestone-sub">+${fmt(bal - con)} growth</div>
    </div>`;
  }).join('');

  makeChart('chart-savings', {
    type: 'line',
    data: {
      labels,
      datasets: [
        { label: 'Portfolio Value', data: balData, borderColor: '#10B981', backgroundColor: 'rgba(16,185,129,0.12)', fill: true, tension: 0.4, pointRadius: 2, borderWidth: 3 },
        { label: 'Contributions', data: contribData, borderColor: '#4F46E5', backgroundColor: 'rgba(79,70,229,0.08)', fill: true, tension: 0.4, pointRadius: 2, borderWidth: 2, borderDash: [4,3] }
      ]
    },
    options: { ...baseChartOpts, scales: { ...baseChartOpts.scales, y: { ...baseChartOpts.scales.y, ticks: { ...baseChartOpts.scales.y.ticks, callback: v => fmtK(v) } } } }
  });
}

// â”€â”€â”€ Tab Switching â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function switchTab(id, btn) {
  document.querySelectorAll('.calc-page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
  $(`page-${id}`).classList.add('active');
  btn.classList.add('active');
  // Trigger calc to ensure charts render correctly in new size
  setTimeout(() => {
    if (id === 'mortgage') calcMortgage();
    if (id === 'vehicle')  calcVehicle();
    if (id === 'personal') calcPersonal();
    if (id === 'savings')  calcSavings();
  }, 50);
}

// â”€â”€â”€ Theme Toggle â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function toggleTheme() {
  const isLight = document.documentElement.classList.toggle('light');
  document.getElementById('theme-btn').textContent = isLight ? 'â˜€ï¸' : 'ğŸŒ™';
  const newTick = isLight ? '#475569' : '#94A3B8';
  const newGrid = isLight ? 'rgba(203,213,225,0.6)' : 'rgba(51,65,85,0.5)';
  const newTooltipBg = isLight ? '#FFFFFF' : '#1E293B';
  const newTooltipBorder = isLight ? '#CBD5E1' : '#334155';
  Object.values(charts).forEach(chart => {
    ['x','y'].forEach(axis => {
      chart.options.scales[axis].grid.color = newGrid;
      chart.options.scales[axis].ticks.color = newTick;
    });
    chart.options.plugins.legend.labels.color = newTick;
    chart.options.plugins.tooltip.backgroundColor = newTooltipBg;
    chart.options.plugins.tooltip.borderColor = newTooltipBorder;
    chart.options.plugins.tooltip.titleColor = isLight ? '#0F172A' : '#F1F5F9';
    chart.options.plugins.tooltip.bodyColor = newTick;
    chart.update();
  });
}

// â”€â”€â”€ Init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
calcMortgage();
calcVehicle();
calcPersonal();
calcSavings();
</script>
</body>
</html>
